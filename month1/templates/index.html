<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- AUTO REFRESH EVERY 30 SECONDS-->
    <meta http-equiv="refresh" content="30">
    <title>SOC Dashboard - Brute-Force Alerts</title>
    <!-- Bootsrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <style>
        .alert-critical {
            background-color: #ffebee;
        }

        .timestamp {
            font-family: monospace;
            font-size: 0.9em;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container mt-5">
        <div class="row">
            <div class="col">
                <h1 class="display-5 text-danger fw-bold">
                    SOC Dashboard - Brute-Force Alerts
                </h1>
                <p class="text-muted">
                    Auto-refreshes every 30 seconds
                </p>
            </div>
        </div>
    </div>

    <!-- LIVE STATS -->
        <div class="row mb-3">
            <div class="alert alert-danger d-inline-block p-2">
                <strong>Active Alerts: {{ alert_count }}</strong>
            </div>
            <span class="text-muted ms-3">
                Last updated: {{ last_updated }}
            </span>
            <form method="POST" action="{{ url_for('clear_alerts') }}" class="d-inline">
                <button type="submit" class="btn btn-outline-danger btn-sm"
                        onclick="return confirm('Close all alerts? This cannot be undone.')">
                    Clear All Alerts
                </button>
            </form>
            <a href="/history" class="btn btn-secondary btn-sm ms-2">View History ({{ history_count }})</a>
            <a href="{{ url_for('run_now') }}" class="btn btn-success btn-sm ms-2">
                Run Detection Now
            </a>
        </div>
    <!-- END STATS -->

    {% if alerts %}
    <div class="table-responsive">
        <table class="table table-hover align middle">
            <thead class="table-danger">
                <tr>
                    <th>IP</th>
                    <th>Attempts</th>
                    <th>Window (mins)</th>
                    <th>First</th>
                    <th>Last</th>
                    <th>Lines</th>
                </tr>
            </thead>
            <tbody>
                {% for alert in alerts %}
                <tr class="alert-critical">
                    <td><strong>{{ alert.ip }}</strong></< /td>
                    <td><span class="badge bg-danger">{{ alert.attempt_count }}</span></td>
                    <td>{{ alert.window_minutes }}</td>
                    <td class="timestamp">{{ alert.first_attempt }}</td>
                    <td class="timestamp">{{ alert.last_attempt }}</td>
                    <td><code>{{ alert.log_lines }}</code></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-success" role="alert">
        <strong>No active alerts.</strong> All systems nominal.
    </div>
    {% endif %}
    
    <!-- After the Active Alerts row -->
     <div class="row mt-4">
        <div class="col">
            <h5 class="text-warning">Blocked IPs (Auto-blocked)</h5>
            {% if blocked_ips %}
            <div class="alert alert-dark">
                {% for ip in blocked_ips %}
                <span class="badge bg-dark me-2">
                    {{ ip }}
                </span>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">No IPs blocked yet.</p>
            {% endif %}
        </div>
     </div>
</body>

</html>